var _e=e=>{let t,n=!1;return()=>n?t:(n=!0,t=e())},Ze=()=>{let e=[];return[t=>L(e,t),()=>{Ye(e)},()=>e.at(-1)]},L=(e,t)=>e.push(t),Ye=e=>e.pop(),U=()=>{},V=e=>()=>{for(let t of e)t()},Re=e=>typeof e=="string",ae=e=>typeof e=="function",se=e=>e!=null&&typeof e=="object",re=Object.is,ce=(e,t)=>t;var xe=re;var[et,tt,ke]=Ze(),z=(e,t=xe)=>{let n={get val(){return ke()?.(n),e},set(o){t(e,o)||(e=o,le(n,o))}};return O.set(n,new Set),n},O=new WeakMap;var N=(e,t)=>(O.get(e).add(t),t(e.val),_e(()=>{O.get(e).delete(t)})),le=(e,t)=>{[...O.get(e)].forEach(n=>{try{n(t)}catch(o){(s=>{let r=s instanceof Error?`stack trace: 
${s.stack}`:JSON.stringify(s);console.error(`[ERROR]: ${r}`)})(o)}})},j=(e,t=xe)=>{let n={get val(){return i(),s}},o=!0,s=null,r=[],i=()=>{if(ke()?.(n),!o)return;o=!1;let[p,u]=(()=>{let f=new Set;return et(d=>{f.add(d)}),[f,()=>{tt()}]})();s=e(),u();for(let f of r)f();r=[...p].map(f=>{let d=O.get(f);return d.add(a),()=>{d.delete(a)}})},a=()=>{o=!0;let p=s;i(),t(p,s)||le(n,s)};return O.set(n,new Set),n};var Te=e=>new Comment(""),ue=e=>{let t=Te(),n=Te();return[()=>{W(t),W(n)},[t,n,()=>{let o=new Range;o.setStart(t,t.length),o.setEnd(n,0),o.deleteContents(),o.detach()}],()=>[t,n]]},fe=document.createElement.bind(document),de=document.createDocumentFragment.bind(document);var ie=(e,t,n)=>n==null||n===!1?e.removeAttribute(t):e.setAttribute(t,`${n}`),pe=(e,t)=>Re(e)?document.querySelector(e):e.querySelector(t);var Ee=(e,t)=>N(t,n=>e.textContent=`${n}`),he=(e,...t)=>{e.length;let n=t.length;return o=>{let s=[],r=[],i=()=>{let a=r.join("");if(a){let p=new Text(a);L(s,()=>W(p)),o(p)}r.length=0};for(let a=0;a<n;a++){L(r,e[a]);let p=t[a];if(se(p)){i();let u=new Text;L(s,Ee(u,p)),L(s,()=>W(u)),o(u)}else L(r,`${p}`)}return L(r,e.at(-1)),i(),V(s)}},ge=(e,t,n)=>N(n,o=>ie(e,t,o)),me=e=>(t,n,o)=>(e.addEventListener(t,n,o),()=>{e.removeEventListener(t,n,o)}),$=e=>t=>(e.appendChild(t),e),J=e=>t=>(e.before(t),e.parentElement);var W=e=>e.remove(),ve=(e,t)=>n=>{let o=[];for(let s=e;s&&s!==t;s=s.nextSibling)L(o,s);t&&L(o,t);for(let s of o)n(s)};var He=(e,t,n)=>o=>{let[s,[r,i,a],p]=ue();o(r),o(i);let u=v=>J(i)(v),f=!1,d=e.val,l=null,E=N(e,v=>{let g=!!v;f&&d===g||(f||(f=!0),d=g,l?.(),a(),[l]=g?t(u):n?.(u)??[null])});return[()=>{E(),l?.(),s()},void 0,p]},nt=[U,void 0,U],je=()=>nt,ye=({condition:e,children:t})=>t?He(e,t.then,t.else):ce("Invalid usage of 'If'. Must provide children.",je),K=({when:e,children:t,fallback:n})=>t?He(e,t,n):ce("Invalid usage of 'Show'. Must provide children.",je),De=({of:e,children:t})=>n=>{let o=[],[s,[r,i,a],p]=ue();n(r),n(i);let u=N(e,f=>{let d=[];for(let R of f)d.push([R,void 0]);let l=0,E=d.length,v=o.length-1,g=E-1;for(l=0;l<=v&&l<=g;l++){let R=o[l],b=d[l];if(!re(R[0],b[0]))break;b[1]=R[1]}for(;l<=v&&l<=g;v--,g--){let R=o[v],b=d[g];if(!re(R[0],b[0]))break;b[1]=R[1]}if(l>v){if(l<=g){let R=d[g+1]?.[1]?.[2]()?.[1]??i;for(;l<=g;l++){let b=J(R),F=d[l];F[1]=t(F[0])(b)}}}else if(l>g)for(;l<=v;l++)o[l][1][0]();else{let R=l,b=l,F=new Map;for(l=R;l<=g;l++){let k=d[l][0];F.set(k,l)}let M,G=0,q=g-b+1,B=!1,_=0,x=Array.from({length:q},()=>0);for(l=R;l<=v;l++){let k=o[l];if(G>=q){k[1][0]();continue}let T=F.get(k[0]);T==null?k[1][0]():(x[T-b]=l+1,T>=_?_=T:B=!0,d[T][1]=k[1],G++)}let D=B?ot(x):[];for(M=D.length-1,l=q-1;l>=0;l--){let k=b+l,T=d[k],I=d[k+1]?.[1][2]()?.[0]??i,A=J(I);if(x[l]===0)T[1]=t(T[0])(A);else if(B)if(M<0||l!==D[M]){let Z=T[1][2]();Z&&ve(...Z)(A)}else M--}}o=d});return[()=>{u(),a(),s()},void 0,p]},ot=e=>{let t=[...e],n=[0],o,s,r,i,a,p=e.length;for(o=0;o<p;o++){let u=e[o];if(u!==0){if(s=n[n.length-1],e[s]<u){t[o]=s,n.push(o);continue}for(r=0,i=n.length-1;r<i;)a=r+i>>1,e[n[a]]<u?r=a+1:i=a;u<e[n[r]]&&(r>0&&(t[o]=n[r-1]),n[r]=o)}}for(r=n.length,i=n[r-1];r-- >0;)n[r]=i,i=t[i];return n};var Ne=(e,t)=>e instanceof Node?(t(e),()=>{W(e)}):ae(e)?e(t)[0]:he`${e}`(t),Fe=(e,t)=>{let n=null,o=null,s=i=>{let a=i instanceof DocumentFragment;return n||(n=a?i.firstChild:i),o=a?i.lastChild:i,t(i)},r=[];if(Array.isArray(e))for(let i of e)L(r,Ne(i,s));else L(r,Ne(e,s));return[r,()=>n&&o?[n,o]:void 0]},st=/^on[A-Z]/,c=(e,t)=>typeof e=="string"?n=>{let o=fe(e),{children:s,ref:r,...i}=t;r&&(r.el=o);let[a]=s!=null?Fe(s,$(o)):[[]];for(let[u,f]of Object.entries(i))if(se(f))L(a,ge(o,u,f));else if(ae(f)&&(p=u,st.test(p))){let d=me(o);L(a,d(u.slice(2).toLowerCase(),f))}else ie(o,u,f);var p;return L(a,()=>W(o)),n(o),[V(a),o,()=>[o,o]]}:e(t),C=c,be=()=>({el:null}),P=({children:e})=>t=>{let n=de(),[o,s]=e?Fe(e,$(n)):[[],U];return t(n),[V(o),void 0,s]};var y={Lighter:-1,Normal:0,Heavier:1},h={Left:-1,Balance:0,Right:1},H={Strategy:1,Conclusion:0};function We(e){return e===y.Lighter?h.Left:h.Right}function rt(e){switch(e){case h.Left:return h.Right;case h.Right:return h.Left;default:return h.Balance}}function Me(e){return Array.from({length:e},(t,n)=>n+1)}var it=[y.Heavier,y.Lighter];function Ae(e,t=it){return e.flatMap(n=>t.map(o=>[n,o]))}function $e(e,t){let[n,o]=e,[s,r]=t;return s.has(n)?We(o):r.has(n)?rt(We(o)):h.Balance}function qe(e){let t=[h.Left,h.Balance,h.Right];function n(o,s,r){if(o.type===H.Conclusion)return{...o,parent:r};let{children:i,...a}=o,u={...a,children:{},parent:r};for(let f of t){let d=o.children[f];d?u.children[f]=n(d,o,u):u.children[f]={type:null,parent:u}}return u}return n(e)}function*Ie(e,t,n){let o=Me(e);function*s(a,p){let u=at(a),{length:f}=a;if(f===0)return;if(f===1){let[[x,D]]=a;if(x==null||D==null)throw new Error("Impossible");yield{type:H.Conclusion,enumerated:[x,D]};return}if(p===0||a.length>3**p)return;let d=p-1,l=3**d,E=[],v=[],g=[],R=new Set(o);for(let[x,D]of u){switch(D){case y.Lighter:E.push(x);break;case y.Heavier:v.push(x);break;default:g.push(x);break}R.delete(x)}let b=[...R],F=E.length,M=v.length,G=g.length,q=b.length,B=e-2,_=e%2;for(let x=B;x>=_;x-=2){let D=(e-x)/2;for(let[k,T,I,A]of Ce(D,[0,0,0,0],[F,M,G,q],0))for(let[Z,Ue,Ve,ze]of Ce(D,[0,0,0,0],[F-k,M-T,G-I,q-A],0)){let Y=new Set([...E.slice(0,k),...v.slice(0,T),...g.slice(0,I),...b.slice(0,A)]),ee=new Set([...E.slice(k,k+Z),...v.slice(T,T+Ue),...g.slice(I,I+Ve),...b.slice(A,A+ze)]),Se=[Y,ee],te=[],ne=[],oe=[];for(let S of a)switch($e(S,Se)){case h.Balance:oe.push(S);break;case h.Left:te.push(S);break;case h.Right:ne.push(S);break;default:break}if([te,ne,oe].some(S=>S.length>l))continue;let Je=function*(){if(!te.length){yield null;return}let S=[...b];for(let m of Y)u.get(m)===y.Heavier&&S.push(m);for(let m of ee)u.get(m)===y.Lighter&&S.push(m);for(let m of s(te,d))yield m}(),Ke=function*(){if(!ne.length){yield null;return}let S=[...b];for(let m of Y)u.get(m)===y.Lighter&&S.push(m);for(let m of ee)u.get(m)===y.Heavier&&S.push(m);for(let m of s(ne,d))yield m}(),Xe=function*(){if(!oe.length){yield null;return}let S=[...b,...Y,...ee];for(let m of s(oe,d))yield m}();for(let S of Je)for(let m of Ke)for(let Le of Xe)!(S||m||Le)||(yield{type:H.Strategy,strategy:Se,cases:a,children:{[h.Left]:S,[h.Balance]:Le,[h.Right]:m}})}}}let r=Ae(o,n),i=Math.ceil(Math.log(r.length)/Math.log(3));yield*s(r,Math.min(t,i))}function at(e){return e.reduce((t,[n,o])=>t.set(n,t.has(n)?y.Normal:o),new Map)}function*Ce(e,t,n,o){if(o===t.length-1){n[o]>=e&&(t[o]=e,yield t);return}let s=Math.min(n[o],e),r=o+1;for(let i=0;i<=s;i++)t[o]=i,yield*Ce(e-i,t,n,r)}var Qe=new URL(location.href),X=Qe.searchParams,Oe=X.get("lang")??"",ct=+(X.get("count")??"")||void 0,lt=+(X.get("times")??"")||void 0,ut=+(X.get("diff")??"")||void 0,ft=["zh","en"],Q=ft.includes(Oe)?Oe:"zh";Q&&document.documentElement.lang!==Q&&(document.documentElement.lang=Q);var dt=Q==="en"?await import("../i18n/en.json",{assert:{type:"json"}}):await import("../i18n/zh.json",{assert:{type:"json"}}),w=dt.default;document.title+=` - ${w["app.description"]}`;var pt=()=>c("header",{children:C("nav",{children:[C("div",{role:"application",children:[c("img",{src:"../icon.svg",class:"logo",alt:"icon.svg"}),c("img",{src:"../text.svg",class:"app-text",alt:"text.svg"})]}),C("div",{class:"menu",role:"menu",children:[c("div",{class:"menu-item",role:"menuitem",children:c("a",{href:"https://github.com/DarrenDanielDay/Libra",target:"_blank",children:c("img",{src:"../github.svg",alt:"github.svg",class:"community"})})}),c("div",{class:"menu-item",role:"menuitem",children:C("select",{onChange:({target:e})=>{let t=new URL(location.href);t.searchParams.delete("lang"),t.searchParams.set("lang",e.value),location.href=t.href},children:[c("option",{value:"zh",selected:Q==="zh",children:"\u7B80\u4F53\u4E2D\u6587"}),c("option",{value:"en",selected:Q==="en",children:"English"})]})})]})]})});function ht(e){switch(e){case-1:return[y.Lighter];case 1:return[y.Heavier];default:return[y.Lighter,y.Heavier]}}var gt=({confirm:e,reset:t})=>C("form",{class:"conditions",onSubmit:n=>{n.preventDefault();let o=new FormData(n.currentTarget),r=["count","times","diff"].reduce((i,a)=>{let p=o.get(a);return typeof p=="string"&&(i[a]=+p),i},{});if(r.count&&r.times&&r.diff!=null){for(let[i,a]of Object.entries(r))X.set(i,a.toString());history.replaceState({},"",Qe),e(r)}},onReset:t,children:[C("div",{class:"condition",children:[c("label",{for:"count",children:w["label.count"]}),c("input",{id:"count",name:"count",type:"number",value:ct?.toString(),required:!0})]}),C("div",{class:"condition",children:[c("label",{for:"times",children:w["label.times"]}),c("input",{id:"times",name:"times",type:"number",value:lt?.toString(),required:!0})]}),C("div",{class:"condition",children:[c("label",{for:"diff",children:w["label.diff"]}),c("select",{id:"diff",name:"diff",value:ut,required:!0,children:[[0,w["diff.unknown"]],[1,w["diff.heavier"]],[-1,w["diff.lighter"]]].map(([n,o])=>c("option",{value:n.toString(),children:o},n))})]}),C("div",{class:"actions",children:[c("button",{type:"submit",class:"submit",children:w["actions.confirm"]}),c("button",{type:"reset",class:"reset",children:w["actions.reset"]})]})]}),Pe=({products:e})=>t=>{let n=be(),[o]=c("div",{ref:n,class:"products"})(t),s=n.el,r=$(s),i=null,a=N(e,([...p])=>{i?.(),[i]=c(P,{children:p.map((u,f)=>C(P,{children:[f?c("code",{children:"+"}):"",C("span",{class:"product",children:["P",u]})]}))})(r)});return[()=>{a(),i?.(),o()},void 0,()=>[s,s]]},Ge=({lefts:e,rights:t,comparator:n})=>C("div",{class:"compare",children:[c(Pe,{products:e}),c("code",{children:n}),c(Pe,{products:t})]}),mt={[y.Lighter]:w["diff.lighter"],[y.Heavier]:w["diff.heavier"]},we=e=>{let t=document.createElement("template");return t.innerHTML=e,c(()=>o=>{let s=be(),r=c("div",{ref:s})(o),i=t.content.cloneNode(!0);return s.el.appendChild(i),r},{})},[vt,yt,bt]=await Promise.all(["../balance-scale-left.svg","../balance-scale.svg","../balance-scale-right.svg"].map(async e=>await(await fetch(e)).text())),Be=[{svg:we(vt),result:h.Right,position:"left"},{svg:we(yt),result:h.Balance,position:"middle"},{svg:we(bt),result:h.Left,position:"right"}],Ct=({node:e,move:t})=>{let n=c("div",{class:"actions",children:c(K,{when:j(()=>!!e.val.parent),children:c("button",{class:"reset",onClick:()=>{t(e.val.parent??!1)},children:w["actions.back"]})})}),o=(s,r,i)=>C("div",{class:`${i} node`,children:[c("p",{class:"info",children:r}),s,n]});return c(ye,{condition:j(()=>e.val.type==null),children:{then:o(c(P,{}),w["info.impossible"],"null"),else:c(ye,{condition:j(()=>e.val.type===H.Conclusion),children:{then:s=>{if(e.val.type!==H.Conclusion)throw new Error("");let[r,i]=e.val.enumerated,a={bad:r,diff:mt[i]};return o(c(P,{}),w["info.conclution"].replace(/\{(.+?)\}/g,(p,u)=>Reflect.get(a,u)),"conclusion")(s)},else:s=>{let r=j(()=>{let a=e.val;if(a.type!==H.Strategy)return[];let{strategy:[p]}=a;return p}),i=j(()=>{let a=e.val;if(a.type!==H.Strategy)return[];let{strategy:[,p]}=a;return p});return o(C(P,{children:[c(Ge,{lefts:r,rights:i,comparator:"vs"}),c("div",{class:"choices",children:Be.map(({svg:a,result:p,position:u},f)=>{let d=()=>{let l=e.val;if(l.type!==H.Strategy)throw new Error("Impossible");t(l.children[p])};return c("div",{class:`choice ${u}`,role:"button",tabIndex:0,onClick:d,onKeydown:l=>{l.key.toLowerCase()==="enter"&&d()},children:a},f)})})]}),w["info.choose"],"choose")(s)}}})}})},wt=e=>{switch(e){case h.Left:return"<";case h.Right:return">";default:return"="}},St=({records:e})=>t=>C("div",{class:"weigh-history",children:[c("p",{children:w["label.history"]}),c(De,{of:e,children:({strategy:[n,o],result:s})=>c(Ge,{lefts:z(n),rights:z(o),comparator:wt(s)})})]})(t),Lt=e=>{let t=Object.fromEntries(Object.entries(e).map(([s,r])=>[s,z(r)])),n=()=>Object.fromEntries(Object.entries(t).map(([s,r])=>[s,r.val]));return[t,s=>{let r=typeof s=="function"?s(n()):s;for(let[i,a]of Object.entries(r))t[i].set(a)}]},Rt=()=>{let[e,t]=Lt({node:!1,root:!1,message:""}),{node:n,root:o,message:s}=e,r=u=>t(f=>({...f,node:u})),i=j(()=>n.val&&(()=>{let u=[];for(let f=n.val;f.parent&&f!==o.val;f=f.parent){let d=f.parent;d.type===H.Strategy&&u.push([d.strategy,Be.find(l=>d.children[l.result]===f).result])}return u.reverse().map(([f,d])=>({strategy:f,result:d}))})());return Object.assign(globalThis,{weighRecords:i}),C("div",{children:[c(pt,{}),C("main",{children:[c(gt,{confirm:({count:u,times:f,diff:d})=>{let l=ht(d);for(let E of Ie(u,f,l)){let v=qe(E);t(g=>({...g,node:v,root:v,message:""}));return}t(E=>({...E,node:!1,root:!1,message:w["info.no.solution"]}))},reset:()=>t({message:"",node:!1,root:!1})}),c(K,{when:j(()=>!!s.val),children:c("div",{class:"alert alert-danger",role:"alert",children:s})}),c(K,{when:j(()=>!!n.val),children:c(Ct,{node:n,move:r})}),c(K,{when:j(()=>{let u=i.val;return u&&!!u.length}),children:c(St,{records:i})})]})]})},xt=pe("div#app");c(Rt,{})($(xt));
/**
 * @license GPL-3.0-or-later
 * Copyright (C) 2022  DarrenDanielDay <Darren_Daniel_Day@hotmail.com>
 *
 * This source code is licensed under the GPL-3.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
 * @license MIT
 * Copyright (C) 2022  DarrenDanielDay <Darren_Daniel_Day@hotmail.com>
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
//# sourceMappingURL=index.js.map
