import{createElement as e,Fragment as ve}from"react";import{Fragment as Ce,memo as w,useCallback as U,useLayoutEffect as Ne,useRef as be,useState as Re}from"react";import*as ne from"react-dom/client";var p={Lighter:-1,Normal:0,Heavier:1},i={Left:-1,Balance:0,Right:1},N={Strategy:1,Conclusion:0};function $(t){return t===p.Lighter?i.Left:i.Right}function me(t){switch(t){case i.Left:return i.Right;case i.Right:return i.Left;default:return i.Balance}}function J(t){return Array.from({length:t},(n,o)=>o+1)}var ye=[p.Heavier,p.Lighter];function K(t,n=ye){return t.flatMap(o=>n.map(r=>[o,r]))}function X(t,n){let[o,r]=t,[f,a]=n;return f.has(o)?$(r):a.has(o)?me($(r)):i.Balance}function Y(t){let n=[i.Left,i.Balance,i.Right];function o(r,f,a){if(r.type===N.Conclusion)return{...r,parent:a};let{children:c,...l}=r,u={...l,children:{},parent:a};for(let s of n){let g=r.children[s];g?u.children[s]=o(g,r,u):u.children[s]={type:null,parent:u}}return u}return o(t)}function*Z(t,n,o){let r=J(t);function*f(l,h){let u=he(l),{length:s}=l;if(s===0)return;if(s===1){let[[v,R]]=l;if(v==null||R==null)throw new Error("Impossible");yield{type:N.Conclusion,enumerated:[v,R]};return}if(h===0||l.length>3**h)return;let g=h-1,D=3**g,C=[],b=[],T=[],I=new Set(r);for(let[v,R]of u){switch(R){case p.Lighter:C.push(v);break;case p.Heavier:b.push(v);break;default:T.push(v);break}I.delete(v)}let S=[...I],O=C.length,A=b.length,Q=T.length,j=S.length,se=t-2,ae=t%2;for(let v=se;v>=ae;v-=2){let R=(t-v)/2;for(let[P,H,W,k]of B(R,[0,0,0,0],[O,A,Q,j],0))for(let[ce,le,ue,de]of B(R,[0,0,0,0],[O-P,A-H,Q-W,j-k],0)){let F=new Set([...C.slice(0,P),...b.slice(0,H),...T.slice(0,W),...S.slice(0,k)]),E=new Set([...C.slice(P,P+ce),...b.slice(H,H+le),...T.slice(W,W+ue),...S.slice(k,k+de)]),z=[F,E],M=[],G=[],V=[];for(let y of l)switch(X(y,z)){case i.Balance:V.push(y);break;case i.Left:M.push(y);break;case i.Right:G.push(y);break;default:break}if([M,G,V].some(y=>y.length>D))continue;let fe=function*(){if(!M.length){yield null;return}let y=[...S];for(let d of F)u.get(d)===p.Heavier&&y.push(d);for(let d of E)u.get(d)===p.Lighter&&y.push(d);for(let d of f(M,g))yield d}(),pe=function*(){if(!G.length){yield null;return}let y=[...S];for(let d of F)u.get(d)===p.Lighter&&y.push(d);for(let d of E)u.get(d)===p.Heavier&&y.push(d);for(let d of f(G,g))yield d}(),ge=function*(){if(!V.length){yield null;return}let y=[...S,...F,...E];for(let d of f(V,g))yield d}();for(let y of fe)for(let d of pe)for(let _ of ge)!(y||d||_)||(yield{type:N.Strategy,strategy:z,cases:l,children:{[i.Left]:y,[i.Balance]:_,[i.Right]:d}})}}}let a=K(r,o),c=Math.ceil(Math.log(a.length)/Math.log(3));yield*f(a,Math.min(n,c))}function he(t){return t.reduce((n,[o,r])=>n.set(o,n.has(o)?p.Normal:r),new Map)}function*B(t,n,o,r){if(r===n.length-1){o[r]>=t&&(n[r]=t,yield n);return}let f=Math.min(o[r],t),a=r+1;for(let c=0;c<=f;c++)n[r]=c,yield*B(t-c,n,o,a)}var oe=new URL(location.href),x=oe.searchParams,ee=x.get("lang")??"",Te=+(x.get("count")??"")||void 0,Se=+(x.get("times")??"")||void 0,De=+(x.get("diff")??"")||void 0,Le=["zh","en"],L=Le.includes(ee)?ee:"zh";L&&document.documentElement.lang!==L&&(document.documentElement.lang=L);var we=L==="en"?await import("./i18n/en.json",{assert:{type:"json"}}):await import("./i18n/zh.json",{assert:{type:"json"}}),m=we.default;document.title+=` - ${m["app.description"]}`;var xe=w(()=>e("header",null,e("nav",null,e("div",{role:"application"},e("img",{src:"./icon.svg",className:"logo",alt:"icon.svg"}),e("img",{src:"./text.svg",className:"app-text",alt:"text.svg"})),e("div",{className:"menu",role:"menu"},e("div",{className:"menu-item",role:"menuitem"},e("a",{href:"https://github.com/DarrenDanielDay/Libra",target:"_blank"},e("img",{src:"./github.svg",alt:"github.svg",className:"community"}))),e("div",{className:"menu-item",role:"menuitem"},e("select",{value:L,onChange:({target:t})=>{let n=new URL(location.href);n.searchParams.delete("lang"),n.searchParams.set("lang",t.value),location.href=n.href}},e("option",{value:"zh"},"\u7B80\u4F53\u4E2D\u6587"),e("option",{value:"en"},"English")))))));function Pe(t){switch(t){case-1:return[p.Lighter];case 1:return[p.Heavier];default:return[p.Lighter,p.Heavier]}}var He=w(({confirm:t,reset:n})=>e("form",{className:"conditions",onSubmit:o=>{o.preventDefault();let r=new FormData(o.currentTarget),a=["count","times","diff"].reduce((c,l)=>{let h=r.get(l);return typeof h=="string"&&(c[l]=+h),c},{});if(a.count&&a.times&&a.diff!=null){for(let[c,l]of Object.entries(a))x.set(c,l.toString());history.replaceState({},"",oe),t(a)}},onReset:n},e("div",{className:"condition"},e("label",{htmlFor:"count"},m["label.count"]),e("input",{id:"count",name:"count",type:"number",defaultValue:Te,required:!0})),e("div",{className:"condition"},e("label",{htmlFor:"times"},m["label.times"]),e("input",{id:"times",name:"times",type:"number",defaultValue:Se,required:!0})),e("div",{className:"condition"},e("label",{htmlFor:"diff"},m["label.diff"]),e("select",{id:"diff",name:"diff",defaultValue:De,required:!0},[[0,m["diff.unknown"]],[1,m["diff.heavier"]],[-1,m["diff.lighter"]]].map(([o,r])=>e("option",{key:o,value:o.toString()},r)))),e("div",{className:"actions"},e("button",{type:"submit",className:"submit"},m["actions.confirm"]),e("button",{type:"reset",className:"reset"},m["actions.reset"])))),te=w(({products:t})=>e("div",{className:"products"},[...t].map((n,o)=>e(Ce,{key:o},!!o&&e("code",null,"+"),e("span",{className:"product"},"P",n))))),re=w(({lefts:t,rights:n,comparator:o})=>e("div",{className:"compare"},e(te,{products:t}),e("code",null,o),e(te,{products:n}))),We={[p.Lighter]:m["diff.lighter"],[p.Heavier]:m["diff.heavier"]},q=t=>{let n=document.createElement("template");n.innerHTML=t;let o=w(()=>{let r=be(null);return Ne(()=>{let f=n.content.cloneNode(!0),a=r.current;!a||a.appendChild(f)},[]),e("div",{ref:r})});return e(o,null)},[ke,Fe,Ee]=await Promise.all(["./balance-scale-left.svg","./balance-scale.svg","./balance-scale-right.svg"].map(async t=>await(await fetch(t)).text())),ie=[{svg:q(ke),result:i.Right,position:"left"},{svg:q(Fe),result:i.Balance,position:"middle"},{svg:q(Ee),result:i.Left,position:"right"}],Me=({node:t,move:n})=>{let o=e("div",{className:"actions"},!!t.parent&&e("button",{className:"reset",onClick:()=>{n(t.parent??!1)}},m["actions.back"])),r=(c,l,h)=>e("div",{className:`${h} node`},e("p",{className:"info"},l),c,o);if(t.type==null)return r(null,m["info.impossible"],"null");if(t.type===N.Conclusion){let[c,l]=t.enumerated,h={bad:c,diff:We[l]};return r(null,m["info.conclution"].replace(/\{(.+?)\}/g,(u,s)=>Reflect.get(h,s)),"conclusion")}let{strategy:[f,a]}=t;return r(e(ve,null,e(re,{lefts:f,rights:a,comparator:"vs"}),e("div",{className:"choices"},ie.map(({svg:c,result:l,position:h},u)=>{let s=()=>{n(t.children[l])};return e("div",{key:u,className:`choice ${h}`,role:"button",tabIndex:0,onClick:s,onKeyDown:g=>{g.key.toLowerCase()==="enter"&&s()}},c)}))),m["info.choose"],"choose")},Ge=t=>{switch(t){case i.Left:return"<";case i.Right:return">";default:return"="}},Ve=({records:t})=>e("div",{className:"weigh-history"},e("p",null,m["label.history"]),t.map(({strategy:[n,o],result:r},f)=>e(re,{key:f,lefts:n,rights:o,comparator:Ge(r)}))),Be=()=>{let[t,n]=Re({node:!1,root:!1,message:""}),{node:o,root:r,message:f}=t,a=U(u=>n(s=>({...s,node:u})),[]),c=o&&history&&(()=>{let u=[];for(let s=o;s.parent&&s!==r;s=s.parent){let g=s.parent;g.type===N.Strategy&&u.push([g.strategy,ie.find(D=>g.children[D.result]===s).result])}return u.reverse().map(([s,g])=>({strategy:s,result:g}))})(),l=U(({count:u,times:s,diff:g})=>{let D=Pe(g);for(let C of Z(u,s,D)){let b=Y(C);n(T=>({...T,node:b,root:b,message:""}));return}n(C=>({...C,node:!1,root:!1,message:m["info.no.solution"]}))},[]),h=U(()=>n({message:"",node:!1,root:!1}),[]);return e("div",null,e(xe,null),e("main",null,e(He,{confirm:l,reset:h}),f&&e("div",{className:"alert alert-danger",role:"alert"},f),o&&e(Me,{node:o,move:a}),c&&!!c.length&&e(Ve,{records:c})))},Ue=document.querySelector("div");ne.createRoot(Ue).render(e(Be,null));
/**
 * @license GPL-3.0-or-later
 * Copyright (C) 2022  DarrenDanielDay <Darren_Daniel_Day@hotmail.com>
 *
 * This source code is licensed under the GPL-3.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
/**
* @license GPL-3.0-or-later
* Copyright (C) 2022  DarrenDanielDay <Darren_Daniel_Day@hotmail.com>
*
* This source code is licensed under the GPL-3.0 license found in the
* LICENSE file in the root directory of this source tree.
*/
//# sourceMappingURL=index.js.map
